---
title: "STAT_306_Project_Group_10"
format: pdf
editor: visual
execute:
  echo: false # Hide code in document
---

# STAT 306 Project

## Nicholas Tam, Ivy Cheung, Kaichi Nakajima, Kevin Liu (Group 10)

## Introduction

Breast invasive ductal carcinoma (IDC) is the most common type of breast cancer, with about 80% of all forms of breast cancer being IDC, according to the American Cancer Society (DePolo, 2024). There are numerous nonsurgical treatments of IDC, such as radiotherapy, chemotherapy, and hormone therapy (Wright, 2023), but it is unclear how combinations of treatments can interact in a model to predict a patient’s survival until death.

For our research project, we have selected a dataset of approximately 1900 primary breast cancer samples, obtained from the Molecular Taxonomy of Breast Cancer International Consortium (METABRIC) database through cBioPortal for Cancer Genomics.

Our project question is:

**"How do radiotherapy, chemotherapy, and hormone therapy influence the length of time a patient with IDC will survive until death, given control variables age, surgery type, and tumor stage?"**

Our analysis will involve the inference of covariates within linear models, and thus \_\_\_

-   Variables from columns 32 to 693 consist of genetic attributes containing m-RNA levels z-score for 331 genes, and mutation for 175 genes; they have been omitted due to being difficult to interpret.

## Analysis

### Loading relevant libraries

```{r}
library(dplyr)
library(tidyverse)
library(ggplot2)
# install.packages("fastDummies")
library(fastDummies)
# install.packages('stringi')
library(car)
```

### Uploading relevant table and narrowing down to data of interest

-   Due to the distribution of “cancer_type_detailed” categories and for ease of computation, we will be filtering the dataset for deceased IDC patients only, as IDC consists of the majority of the dataset, and the “overall_survival” column for living patients would be inconsistent for living patients due to time.

-   “tumor_size” has been removed due to already partly contributing to “tumor_stage”. (Susan G. Komen®, 2024)

-   All rows with "N/A" or "" as their values for any column have been removed to ensure no data is missing.

-   All categorical variables are transformed to be treated as categorical by the table.

```{r}
cancer = read.csv("METABRIC_RNA_Mutation.csv", header=TRUE)[,1:31]
cancer_new <- cancer %>% 
  drop_na(age_at_diagnosis, type_of_breast_surgery, tumor_size, tumor_stage, chemotherapy, hormone_therapy, radio_therapy, overall_survival_months, death_from_cancer) %>% 
  filter(!(age_at_diagnosis==""), !(type_of_breast_surgery==""), !(tumor_size==""), !(tumor_stage==""), !(chemotherapy==""), !(hormone_therapy==""), !(radio_therapy==""), !(overall_survival_months==""), cancer_type_detailed == "Breast Invasive Ductal Carcinoma", !(tumor_stage==0), !(tumor_stage==4), !(death_from_cancer=="")) %>% 
  transform(
    type_of_breast_surgery = as.factor(type_of_breast_surgery), 
    tumor_stage = as.factor(tumor_stage), 
    chemotherapy = as.factor(chemotherapy), 
    hormone_therapy = as.factor(hormone_therapy), 
    radio_therapy = as.factor(radio_therapy), 
    death_from_cancer = as.factor(death_from_cancer)
    ) %>% 
  select(age_at_diagnosis, type_of_breast_surgery, tumor_stage, chemotherapy, hormone_therapy, radio_therapy, death_from_cancer,  overall_survival_months) 
# !(death_from_cancer=="")
cancer_new$tumor_stage <- relevel(factor(cancer_new$tumor_stage), ref = "1")
# cancer_new$death_from_cancer <- relevel(factor(cancer_new$death_from_cancer), ref = "Living")

head(cancer_new, 10)
summary(cancer_new)
```

### Exploratory data analysis

-   

```{r}
scatterplot(overall_survival_months~age_at_diagnosis, data=cancer_new, smooth=FALSE, main="Overall Survival against Age", xlab="Age (Years)", ylab="Overall Survival (Months)")
```

```{r}
boxplot(overall_survival_months~type_of_breast_surgery, data=cancer_new)

boxplot(overall_survival_months~chemotherapy, data=cancer_new)

boxplot(overall_survival_months~hormone_therapy, data=cancer_new)

boxplot(overall_survival_months~radio_therapy, data=cancer_new)

boxplot(overall_survival_months~tumor_stage, data=cancer_new)

boxplot(overall_survival_months~death_from_cancer, data=cancer_new)
```

```{r}
reg_0 = lm(overall_survival_months~age_at_diagnosis*type_of_breast_surgery,data=cancer_new)  # TODO
summary(reg_0)
scatterplot(overall_survival_months~age_at_diagnosis*type_of_breast_surgery, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Breast Surgery", xlab="Age (Years)", ylab="Overall Survival (Months)")

reg_1 = lm(overall_survival_months~age_at_diagnosis*chemotherapy,data=cancer_new)  # TODO
summary(reg_1)
scatterplot(overall_survival_months~age_at_diagnosis*chemotherapy, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Chemotherapy", xlab="Age (Years)", ylab="Overall Survival (Months)")

reg_2 = lm(overall_survival_months~age_at_diagnosis*hormone_therapy,data=cancer_new)  # TODO
summary(reg_2)
scatterplot(overall_survival_months~age_at_diagnosis*hormone_therapy, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Hormone Therapy", xlab="Age (Years)", ylab="Overall Survival (Months)")

reg_3 = lm(overall_survival_months~age_at_diagnosis*radio_therapy,data=cancer_new)  # TODO
summary(reg_3)
scatterplot(overall_survival_months~age_at_diagnosis*radio_therapy, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Radio Therapy", xlab="Age (Years)", ylab="Overall Survival (Months)")

reg_4 = lm(overall_survival_months~age_at_diagnosis*tumor_stage,data=cancer_new)  # TODO
summary(reg_4)
scatterplot(overall_survival_months~age_at_diagnosis*tumor_stage, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Tumor Stage", xlab="Age (Years)", ylab="Overall Survival (Months)")

# reg_3_1 = lm(overall_survival_months~age_at_diagnosis+radio_therapy,data=cancer_new)  # TODO
# summary(reg_3_1)
# scatterplot(overall_survival_months~age_at_diagnosis+radio_therapy, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Radio Therapy", xlab="Age (Years)", ylab="Overall Survival (Months)")

reg_5 = lm(overall_survival_months~age_at_diagnosis*death_from_cancer,data=cancer_new)  # TODO
summary(reg_5)
scatterplot(overall_survival_months~age_at_diagnosis*death_from_cancer, data=cancer_new, smooth=FALSE, main="Overall Survival against Age and Tumor Stage", xlab="Age (Years)", ylab="Overall Survival (Months)")
```

### Model selection

-   

```{r}
fullmod = lm(overall_survival_months ~ .*.,data=cancer_new)
finalmod = step(fullmod, direction = "both", trace = 1)
# finalmod = step(fullmod, direction = "both", trace = 0)
```

```{r}
summary(finalmod)
```

```{r}
# Create the residual plot
# TODO
plot(finalmod$fitted.values, finalmod$residuals, xlab="Fitted Values", ylab="Residuals")
abline(a = 0, b = 0)
lines(lowess(finalmod$fitted.values, finalmod$residuals), col = "blue", lwd = 2)
```

```{r}
qqnorm(finalmod$residuals)
qqline(finalmod$residuals)
```

## Conclusion

## Appendix

-   Breast cancer gene expression profiles (METABRIC). Kaggle. (2016, May 10). <https://www.kaggle.com/datasets/raghadalharbi/breast-cancer-gene-expression-profiles-metabric>   

-   CBioPortal for Cancer Genomics. (n.d.). <https://www.cbioportal.org/study/summary?id=brca_metabric>

-   DePolo, J. (2024, October 2). Invasive ductal carcinoma (IDC). Breastcancer.org - Breast Cancer Information and Support. <https://www.breastcancer.org/types/invasive-ductal-carcinoma>  

-   Wright , P. (2023, March 21). Invasive ductal carcinoma (IDC). Johns Hopkins Medicine. <https://www.hopkinsmedicine.org/health/conditions-and-diseases/breast-cancer/invasive-ductal-carcinoma-idc#:~:text=Radiation%20therapy%20might%20be%20part,lymph%20nodes%2C%E2%80%9D%20Wright%20says>. 

-   Tumor size and staging. Susan G. Komen®. (2024, May 2). <https://www.komen.org/breast-cancer/diagnosis/stages-staging/tumor-size/#:~:text=Tumor%20size%20is%20related%20to,the%20size%20of%20the%20tumor>.
